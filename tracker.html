<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Access Nature - Trail Tracker</title>
  
  <!-- External CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css">
  
  <!-- Project CSS -->
  <link rel="stylesheet" href="src/css/base.css">
  <link rel="stylesheet" href="src/css/layout.css">
  <link rel="stylesheet" href="src/css/components.css">
  <link rel="stylesheet" href="src/css/accessibility.css">
  <link rel="stylesheet" href="src/css/themes.css">
  <link rel="stylesheet" href="src/css/enhanced_components_css.css">
  <link rel="stylesheet" href="src/css/tracker_styles_css.css">
</head>
<body>
  <!-- Skip navigation for screen readers -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <a href="#map-region" class="skip-link">Skip to map</a>

  <!-- Full-screen map -->
  <div class="map-container" 
       role="application" 
       aria-label="Interactive trail map"
       id="map-region"
       tabindex="0">
    <div id="map"></div>
  </div>

  <!-- Status header - translucent over map -->
  <header class="status-header" role="banner">
    <div class="status-item">
      <span class="status-value" id="timer" aria-live="polite">00:00:00</span>
      <span class="status-label">Time</span>
    </div>
    
    <div class="status-item">
      <span class="status-value" id="distance" aria-live="polite">0.00 km</span>
      <span class="status-label">Distance</span>
    </div>
  </header>

  <!-- Enhanced compass section with heading display -->
  <div class="compass-section">
    <div class="compass-container" id="compass" role="img" aria-label="Navigation compass">
      <div class="compass-needle" id="compass-needle"></div>
    </div>
    <div class="compass-heading" id="compass-heading" aria-live="polite">0°</div>
  </div>

  <!-- Map rotation toggle - top right -->
  <button class="map-rotation-toggle" 
          id="mapRotationToggle"
          aria-label="Toggle map rotation"
          title="Enable/disable map rotation with device orientation">
    🧭
  </button>

  <!-- Cloud sync indicator -->
  <div id="cloudSyncIndicator" class="cloud-sync-indicator hidden">
    <span class="sync-icon">☁️</span>
    <span class="sync-text">Syncing...</span>
  </div>

  <!-- Primary action controls - accessibility, play/pause, save -->
  <main class="primary-controls" id="main-content" role="main">
    <button class="control-button accessibility-btn" 
            onclick="openAccessibilityForm()"
            aria-label="Document trail accessibility features"
            title="Open accessibility survey">
      <span aria-hidden="true">♿</span>
      <span class="sr-only">Accessibility Survey</span>
    </button>

    <button class="control-button play-pause-btn" 
            id="playPauseBtn"
            aria-label="Start tracking"
            title="Start or pause GPS tracking">
      <span aria-hidden="true">▶</span>
      <span class="sr-only">Start Tracking</span>
    </button>

    <button class="control-button save-btn" 
            id="saveBtn"
            disabled
            aria-label="Save route"
            title="Stop tracking and save route">
      <span aria-hidden="true">💾</span>
      <span class="sr-only">Save Route</span>
    </button>
  </main>

  <!-- Bottom menu - minimal and clean -->
  <nav class="bottom-menu" role="navigation" aria-label="Main navigation">
    <button class="menu-button" 
            onclick="addTextNote()" 
            aria-label="Add text note"
            title="Add a text note to your current location">
      <div class="menu-icon">📝</div>
      <div class="menu-label">Note</div>
    </button>

    <button class="menu-button" 
            id="takePhotoBtn" 
            aria-label="Take photo"
            title="Capture a photo of trail conditions or accessibility features">
      <div class="menu-icon">📷</div>
      <div class="menu-label">Photo</div>
    </button>

    <button class="menu-button" 
            onclick="window.location.href='index.html'" 
            aria-label="Go to home page"
            title="Return to AccessNature home page">
      <div class="menu-icon">🏠</div>
      <div class="menu-label">Home</div>
    </button>

    <button class="menu-button" 
            onclick="togglePanel('quickActionsPanel')" 
            aria-label="Open menu"
            title="Open additional options and export tools">
      <div class="menu-icon">⋮</div>
      <div class="menu-label">Menu</div>
    </button>
  </nav>

  <!-- Quick Actions Panel -->
  <div id="quickActionsPanel" class="bottom-popup hidden" role="dialog" aria-labelledby="quick-actions-title">
    <h3 id="quick-actions-title" class="popup-title">Quick Actions</h3>
    
    <div class="popup-grid">
      <button onclick="showRouteDataOnMap()" class="popup-button">
        🗺️ Show Route
      </button>
      
      <button onclick="togglePanel('exportPanel')" class="popup-button">
        📤 Export
      </button>
      
      <button id="saveToCloudBtn" class="popup-button popup-button-primary">
        ☁️ Save Cloud
      </button>
      
      <button id="loadCloudRoutesBtn" class="popup-button popup-button-primary">
        📥 Load Cloud
      </button>
    </div>
  </div>

  <!-- Export Panel -->
  <div id="exportPanel" class="bottom-popup hidden">
    <h3 class="popup-title">Export Route</h3>
    <div class="popup-grid">
      <button id="prepareAndExportBtn" class="popup-button">📦 Export Route</button>
      <button id="exportGPXBtn" class="popup-button">📍 Export GPX</button>
      <button id="exportPDFBtn" class="popup-button">📄 Export PDF</button>
      <button id="exportSummaryBtn" class="popup-button">🌐 Export Trail Guide</button>
    </div>
  </div>

  <!-- Enhanced Accessibility Form Modal with fixed scrolling -->
  <div id="accessibilityOverlay" class="overlay hidden">
    <div class="modal-container">
      <button class="modal-close-top" onclick="closeAccessibilityForm()" aria-label="Close accessibility form">
        ✕
      </button>
      <div id="accessibilityFormContainer"></div>
    </div>
  </div>

  <!-- Hidden file inputs -->
  <input type="file" id="photoInput" accept="image/*" capture="environment" class="hidden">
  <input type="file" id="importFile" accept=".json,.gpx" class="hidden">

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <!-- Main Application Script as Module -->
  <script type="module" src="src/tracker-app.js"></script>
</body>
</html>